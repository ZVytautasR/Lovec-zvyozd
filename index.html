<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>–ò–≥—Ä–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</title>
    <link rel="stylesheet" href="style.css?v=2">
</head>
<body>
    <div id="vk-app">
        <div class="game-container">
            <div class="game-header">
                <h1>üéÆ –õ–æ–≤–µ—Ü –ó–≤—ë–∑–¥</h1>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">–û—á–∫–∏:</span>
                        <span id="score">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">–†–µ–∫–æ—Ä–¥:</span>
                        <span id="high-score">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">–ñ–∏–∑–Ω–∏:</span>
                        <span id="lives">3</span>
                    </div>
                </div>
            </div>
            
            <div id="game-screen" class="game-screen" style="display: flex !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 99999 !important;">
                <canvas id="gameCanvas" style="display: block !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 99999 !important; background: #1a1a2e !important;"></canvas>
                <!-- –í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
                <div id="debug-indicator" style="position: absolute; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 100000; font-size: 20px; display: block !important;">–ò–ì–†–ê –ó–ê–ì–†–£–ñ–ï–ù–ê</div>
            </div>
            
            <div class="game-controls">
                <button id="startBtn" class="btn btn-primary">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button id="pauseBtn" class="btn btn-secondary" disabled>–ü–∞—É–∑–∞</button>
            </div>
            
            <div id="game-over" class="game-over hidden">
                <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="final-score">0</span></p>
                <button id="restartBtn" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        </div>
    </div>
    
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        console.log('HTML –∑–∞–≥—Ä—É–∂–µ–Ω');
        console.log('Canvas —ç–ª–µ–º–µ–Ω—Ç:', document.getElementById('gameCanvas') ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω');
        console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã:', document.getElementById('vk-app') ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω');
    </script>
    <script src="vk.js?v=2"></script>
    <script src="game.js?v=2"></script>
    <script>
        // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
        window.addEventListener('load', function() {
            console.log('–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            console.log('–ò–≥—Ä–∞:', window.game ? '–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞' : '–Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            
            const canvas = document.getElementById('gameCanvas');
            const app = document.getElementById('vk-app');
            const container = document.querySelector('.game-container');
            
            if (canvas) {
                const canvasStyle = window.getComputedStyle(canvas);
                console.log('Canvas –≤–∏–¥–∏–º:', canvas.offsetWidth > 0 ? '–¥–∞' : '–Ω–µ—Ç');
                console.log('Canvas —Ä–∞–∑–º–µ—Ä—ã:', canvas.offsetWidth, 'x', canvas.offsetHeight);
                console.log('Canvas display:', canvasStyle.display);
                console.log('Canvas visibility:', canvasStyle.visibility);
                console.log('Canvas opacity:', canvasStyle.opacity);
                console.log('Canvas position:', canvasStyle.position);
                console.log('Canvas z-index:', canvasStyle.zIndex);
            }
            
            if (app) {
                const appStyle = window.getComputedStyle(app);
                console.log('vk-app —Ä–∞–∑–º–µ—Ä—ã:', app.offsetWidth, 'x', app.offsetHeight);
                console.log('vk-app display:', appStyle.display);
            }
            
            if (container) {
                const containerStyle = window.getComputedStyle(container);
                console.log('game-container —Ä–∞–∑–º–µ—Ä—ã:', container.offsetWidth, 'x', container.offsetHeight);
                console.log('game-container display:', containerStyle.display);
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (app) {
                app.style.display = 'block';
                app.style.visibility = 'visible';
                app.style.opacity = '1';
                app.style.position = 'static';
                app.style.zIndex = '999999';
                app.style.width = '100%';
                app.style.margin = '0';
                app.style.padding = '10px';
                app.style.top = '0';
                app.style.left = '0';
            }
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ body –∏ html –≤ –Ω–∞—á–∞–ª–µ
            document.body.style.position = 'static';
            document.body.style.top = '0';
            document.body.style.left = '0';
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            document.documentElement.style.position = 'static';
            document.documentElement.style.top = '0';
            document.documentElement.style.left = '0';
            document.documentElement.style.margin = '0';
            document.documentElement.style.padding = '0';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å—Ä–∞–∑—É
            window.scrollTo(0, 0);
            setTimeout(() => {
                window.scrollTo(0, 0);
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            }, 100);
            
            if (container) {
                container.style.display = 'block';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                container.style.position = 'relative';
            }
            
            if (canvas) {
                canvas.style.display = 'block';
                canvas.style.visibility = 'visible';
                canvas.style.opacity = '1';
                canvas.style.width = '800px';
                canvas.style.height = '600px';
                canvas.style.maxWidth = '100%';
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º canvas –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
            if (window.game && window.game.draw) {
                setTimeout(() => {
                    window.game.draw();
                    console.log('Canvas –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–Ω (1)');
                }, 100);
                
                setTimeout(() => {
                    window.game.draw();
                    console.log('Canvas –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–Ω (2)');
                }, 500);
                
                setTimeout(() => {
                    window.game.draw();
                    console.log('Canvas –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–Ω (3)');
                }, 1000);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–µ–Ω –≤ DOM
            setTimeout(() => {
                if (canvas) {
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    window.scrollTo(0, 0);
                    document.body.scrollTop = 0;
                    document.documentElement.scrollTop = 0;
                    
                    const canvasRect = canvas.getBoundingClientRect();
                    console.log('=== –ü–†–û–í–ï–†–ö–ê –í–ò–î–ò–ú–û–°–¢–ò CANVAS ===');
                    console.log('Window inner —Ä–∞–∑–º–µ—Ä—ã:', window.innerWidth, 'x', window.innerHeight);
                    console.log('Window scrollY:', window.scrollY);
                    console.log('Document body scrollTop:', document.body.scrollTop);
                    console.log('Canvas getBoundingClientRect:', JSON.stringify({
                        top: Math.round(canvasRect.top),
                        left: Math.round(canvasRect.left),
                        bottom: Math.round(canvasRect.bottom),
                        right: Math.round(canvasRect.right),
                        width: Math.round(canvasRect.width),
                        height: Math.round(canvasRect.height)
                    }));
                    
                    // –ë–æ–ª–µ–µ –º—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                    const isVisible = canvasRect.top < window.innerHeight && 
                                     canvasRect.bottom > 0 && 
                                     canvasRect.left < window.innerWidth && 
                                     canvasRect.right > 0;
                    console.log('Canvas –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ viewport:', isVisible ? '–î–ê' : '–ù–ï–¢');
                    
                    if (!isVisible || canvasRect.top > 50) {
                        console.warn('‚ö†Ô∏è Canvas –ù–ï –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏–ª–∏ —Å–º–µ—â–µ–Ω! –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É...');
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        window.scrollTo(0, 0);
                        document.body.scrollTop = 0;
                        document.documentElement.scrollTop = 0;
                        
                        // –ï—Å–ª–∏ canvas –≤—Å—ë –µ—â—ë —Å–º–µ—â–µ–Ω, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
                        setTimeout(() => {
                            const newRect = canvas.getBoundingClientRect();
                            if (newRect.top > 50) {
                                canvas.scrollIntoView({ behavior: 'instant', block: 'start' });
                                console.log('–ü—Ä–æ–∫—Ä—É—Ç–∏–ª–∏ –∫ canvas, –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è top:', newRect.top);
                            }
                        }, 200);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∏—Å—É–µ—Ç
                    if (window.game && window.game.ctx) {
                        try {
                            const imageData = window.game.ctx.getImageData(0, 0, 1, 1);
                            console.log('Canvas —Ä–∏—Å—É–µ—Ç - —Ü–≤–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–∏–∫—Å–µ–ª—è:', imageData.data[0], imageData.data[1], imageData.data[2]);
                        } catch (e) {
                            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ canvas:', e);
                        }
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∏–¥–µ–Ω –ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                const indicator = document.getElementById('debug-indicator');
                if (indicator) {
                    const indicatorRect = indicator.getBoundingClientRect();
                    console.log('–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–∏–º:', indicatorRect.width > 0 && indicatorRect.height > 0 ? '–î–ê' : '–ù–ï–¢');
                    console.log('–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏—è:', JSON.stringify({
                        top: Math.round(indicatorRect.top),
                        left: Math.round(indicatorRect.left)
                    }));
                    if (indicatorRect.width === 0 || indicatorRect.height === 0) {
                        console.warn('‚ö†Ô∏è –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ –≤–∏–¥–µ–Ω!');
                    }
                }
            }, 1500);
        });
    </script>
</body>
</html>

